<br>
<text style="font-size: 50px;font-weight: 100;">Data list</text>
<br>

<ul class="mdc-list demo-list mdc-list--two-line mdc-list--avatar-list" id="dataList"></ul>

<br><br>

<ul class="mdc-list demo-list mdc-list--two-line mdc-list--avatar-list">
	<div>
		<div class="mdc-list-item mdc-ripple-upgraded mdc-ripple" tabindex="0" data="off" id="a1" onclick="expand_toggle('b1')">
		  <span class="mdc-deprecated-list-item__ripple mdc-ripple"></span>
		  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
		  <span class="mdc-list-item__text">
		    <span class="mdc-list-item__primary-text">Dog Photos</span>
		    <span class="mdc-list-item__secondary-text">9 Jan 2018</span>
		  </span>
		  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
		</div>
		<div data="off" id="b1" class="list-details">
			
		</div>
		<li class="mdc-list-divider" role="separator"></li>
	</div>
	<div>
		<div class="mdc-list-item mdc-ripple-upgraded mdc-ripple" tabindex="0" data="off" id="a2" onclick="expand_toggle('b2')">
		  <span class="mdc-deprecated-list-item__ripple mdc-ripple"></span>
		  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
		  <span class="mdc-list-item__text">
		    <span class="mdc-list-item__primary-text">Dog Photos</span>
		    <span class="mdc-list-item__secondary-text">9 Jan 2018</span>
		  </span>
		  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
		</div>
		<div data="off" id="b2" class="list-details">
			
		</div>
		<li class="mdc-list-divider" role="separator"></li>
	</div>
	<div>
		<div class="mdc-list-item mdc-ripple-upgraded mdc-ripple" tabindex="0" id="a3" onclick="expand_toggle('b3')">
		  <span class="mdc-deprecated-list-item__ripple mdc-ripple"></span>
		  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
		  <span class="mdc-list-item__text">
		    <span class="mdc-list-item__primary-text">Dog Photos</span>
		    <span class="mdc-list-item__secondary-text">9 Jan 2018</span>
		  </span>
		  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
		</div>
		<div data="off" id="b3" class="list-details">
			
		</div>
		<li class="mdc-list-divider" role="separator"></li>
	</div>
</ul>



<!-- <div class="mdc-data-table" style="width: 100%;">
  <div class="mdc-data-table__table-container">
    <table class="mdc-data-table__table" aria-label="Dessert calories">
      <thead>
        <tr class="mdc-data-table__header-row">
          <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Name</th>
          <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">Age</th>
          <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">Note</th>
        </tr>
      </thead>
      <tbody class="mdc-data-table__content" style="text-align: left;">
        <tr class="mdc-data-table__row">
          <th class="mdc-data-table__cell mdc-data-table__cell--left" scope="row">Frozen yogurt</th>
          <td class="mdc-data-table__cell mdc-data-table__cell--numeric">24</td>
          <td class="mdc-data-table__cell mdc-data-table__cell--numeric">4.0</td>
        </tr>
        <tr class="mdc-data-table__row">
          <th class="mdc-data-table__cell mdc-data-table__cell--left" scope="row">Ice cream sandwich</th>
          <td class="mdc-data-table__cell mdc-data-table__cell--numeric">37</td>
          <td class="mdc-data-table__cell mdc-data-table__cell--numeric">4.33333333333</td>
        </tr>
        <tr class="mdc-data-table__row">
          <th class="mdc-data-table__cell mdc-data-table__cell--left" scope="row">Eclair</th>
          <td class="mdc-data-table__cell mdc-data-table__cell--numeric">24</td>
          <td class="mdc-data-table__cell mdc-data-table__cell--numeric">6.0</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<br>
<br>

<ul class="mdc-list demo-list mdc-list--two-line mdc-list--avatar-list">
	<li class="mdc-list-item mdc-ripple-upgraded mdc-ripple" tabindex="0" id="11daea9c-751c-48a9-8784-3f69e5339b68">
	  <span class="mdc-deprecated-list-item__ripple mdc-ripple"></span>
	  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
	  <span class="mdc-list-item__text">
	    <span class="mdc-list-item__primary-text">Dog Photos</span>
	    <span class="mdc-list-item__secondary-text">9 Jan 2018</span>
	  </span>
	  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
	</li>

	<li class="mdc-list-item mdc-ripple-upgraded mdc-ripple" tabindex="-1" id="c82beb69-eef3-4a67-824e-8b971fcaa714">
	  <span class="mdc-list-item__ripple mdc-ripple"></span>
	  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
	  <span class="mdc-list-item__text">
	    <span class="mdc-list-item__primary-text">Cat Photos</span>
	    <span class="mdc-list-item__secondary-text">22 Dec 2017</span>
	  </span>
	  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
	</li>

	<li class="mdc-list-divider" role="separator"></li>

	<li class="mdc-list-item mdc-ripple-upgraded" tabindex="-1" id="ecbd743d-680a-40d2-adb9-76d881788763">
	  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
	  <span class="mdc-list-item__text">
	    <span class="mdc-list-item__primary-text">Potatoes</span>
	    <span class="mdc-list-item__secondary-text">30 Nov 2017</span>
	  </span>
	  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
	</li>

	<li class="mdc-list-item mdc-ripple-upgraded" tabindex="-1" id="d436a5db-0f0a-458f-9b55-1b59a44b1df8">
	  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">folder</span>
	  <span class="mdc-list-item__text">
	    <span class="mdc-list-item__primary-text">Carrots</span>
	    <span class="mdc-list-item__secondary-text">17 Oct 2017</span>
	  </span>
	  <span class="mdc-list-item__meta material-icons" aria-hidden="true">info</span>
	</li>
</ul>

<br> -->

<div data="fab-impact-fixer" style="
	height: 100px;
"></div>

<script>

function open_data_add_window(){
    $("#data_add_window").css("height", "70vh");
    $("#data_add_window").css("width", "100vw");
    $("#data_add_window").css("bottom", "0px");
    $("#data_add_window").css("right", "0px");
    // $("#data_add_window").css("margin-left", "unset");
    // $("#data_add_window").css("margin-top", "unset");
    $("#data_add_window").css("border-radius", "0px");
    $("#add-data-btn").attr("onclick", "close_data_add_window();");
    $("#add-data-btn").attr("class", "mdc-icon-button");
    $("#add-back-icon").html("arrow_back");
    $("#mdc-top-app-bar__section--align-start-add-data").attr("class", "mdc-top-app-bar__section mdc-top-app-bar__section--align-start");
}

function close_data_add_window(){
    $("#data_add_window").css("height", "56px");
    $("#data_add_window").css("width", "56px");
    $("#data_add_window").css("bottom", "16px");
    $("#data_add_window").css("right", "16px");
    // $("#data_add_window").css("margin-left", "-71px");
    // $("#data_add_window").css("margin-top", "-71px");
    $("#data_add_window").css("border-radius", "100px");
    $("#add-data-btn").attr("onclick", "open_data_add_window();");
    $("#add-data-btn").attr("class", "mdc-fab");
    $("#add-back-icon").html("add");
    $("#mdc-top-app-bar__section--align-start-add-data").attr("class", "");
}

function expand_toggle(id){
    if($("#"+id).attr('data') === 'off'){
        $(".list-details").css("height", "0px");
        $(".list-details").attr("data", "off");
        $("#"+id).attr('data', 'on');
        $("#"+id).css("height", "70px");
    }
    else if($("#"+id).attr('data') === 'on'){
        $("#"+id).attr('data', 'off');
        $("#"+id).css("height", "0px");
    }
}

var database = firebase.database();

function add_data(){
	$('#prog').css('width','100vw');
    var name = $("#name").val().trim();
    var age = $("#age").val().trim();
    var note = $("#note").val().trim();
    lastKey = database.ref('items').push({
        text: name,
        numbers:age,
        note: note,
        state: 'off',
        timestamp: new Date().getTime()
    }).key;
    // lastKey = database.ref('items').push().key;
    $("."+lastKey).css("background", "yellow");
    setTimeout(()=>{
    	$("."+lastKey).css("background", "none");
    	$("."+lastKey).css("transition", "2000ms");
    },2000);
    console.log(lastKey);
    clear_create_data();
    close_data_add_window();
    $('#prog').css('width','0vw');
}
lastKey = 0;
list_data();
function list_data(){
    $('#prog').css('width','100vw');
    database.ref('items').orderByChild('timestamp').on('value', function(snapshot) {
        var dataList = document.getElementById('dataList');
        dataList.innerHTML = '';
        var items = [];

        snapshot.forEach(function(childSnapshot) {
            
            var key = childSnapshot.key;
            if (key != 'count') {
            	var data = childSnapshot.val();
                items.push({key: key, data: data});  // Push each item into the array
            }
        });

        items.reverse().forEach(function(childSnapshot) {
            var data = childSnapshot.data;
            var key = childSnapshot.key;
            if (key != 'count') {

	            var listItem = document.createElement('div');
	            $(listItem).attr("class", "list-key "+childSnapshot.key)
	            $(listItem).html("<div class='mdc-list-item mdc-ripple-upgraded mdc-ripple' tabindex='0' data='off' onclick='expand_toggle(\"" + key + "\");'><span class='mdc-deprecated-list-item__ripple mdc-ripple'></span><span class='mdc-list-item__graphic material-icons' aria-hidden='true'>folder</span><span class='mdc-list-item__text'><span class'mdc-list-item__primary-text'>"+data.text+"</span><span class='mdc-list-item__secondary-text'>123</span></span><span class='mdc-list-item__meta material-icons' aria-hidden='true'>info</span></div><div data='off' id='"+key+"' class='list-details'></div><li class='mdc-list-divider' role='separator'></li>");
	            dataList.appendChild(listItem);
	            
		        // if (key === lastKey) {
		        //     listItem.style.backgroundColor = 'lightblue';
		        //     console.log(lastKey);
		        // }
				var listItems = document.querySelectorAll('.mdc-list-item');
				listItems.forEach(item => {
					mdc.ripple.MDCRipple.attachTo(item);
				});

            }
        });
        $('#prog').css('width','0vw');
    });
}

function submit_state(){
    var name = $("#name").val().trim();
    var age = $("#age").val().trim();
    var note = $("#note").val().trim();
    if (name === "" || age === "") {
        $("#clr-btn").attr("disabled", "disabled");
        $("#submit-btn").attr("disabled", "disabled");
    }
    else{
        $("#clr-btn").removeAttr("disabled");
        $("#submit-btn").removeAttr("disabled");
    }
}
function clear_create_data(){
    $("#name").val(null);
    $("#age").val(null);
    $("#note").val(null);
    submit_state();
}

var mdctextFields = document.querySelectorAll('.mdc-text-field');
mdctextFields.forEach(field => {
    mdc.textField.MDCTextField.attachTo(field);
});
var buttons = document.querySelectorAll('.mdc-button');
buttons.forEach(button => {
    mdc.ripple.MDCRipple.attachTo(button);
});
var listItems = document.querySelectorAll('.mdc-list-item');
listItems.forEach(item => {
	mdc.ripple.MDCRipple.attachTo(item);
});
</script>
